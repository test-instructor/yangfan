(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{457:function(s,t,a){s.exports=a.p+"assets/img/hooks.67f9efa3.png"},495:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在v4 go版本之前"),t("code",[s._v("setup_hooks")]),s._v("和"),t("code",[s._v("teardown_hooks")]),s._v("用于在请求前和返回后的一些操作操作，在"),t("code",[s._v("v4")]),s._v("中只能作为一个函数，无法修改任何的内容")]),s._v(" "),t("h2",{attrs:{id:"v4-go版本与python版本的差异"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#v4-go版本与python版本的差异"}},[s._v("#")]),s._v(" "),t("code",[s._v("V4")]),s._v(" go版本与python版本的差异")]),s._v(" "),t("h3",{attrs:{id:"python"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#python"}},[s._v("#")]),s._v(" python")]),s._v(" "),t("ol",[t("li",[s._v("调用函数进行数据处理")]),s._v(" "),t("li",[s._v("由于函数驱动用的也是python，可以直接修改函对象的内容，所以不用返回数据也可以实现修改请求和返回的数据")]),s._v(" "),t("li",[s._v("使用"),t("code",[s._v("request")]),s._v("作为请求内容的参数，使用"),t("code",[s._v("response")]),s._v("作为返回内容的参数")])]),s._v(" "),t("h3",{attrs:{id:"go"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#go"}},[s._v("#")]),s._v(" go")]),s._v(" "),t("ol",[t("li",[s._v("调用函数只能处理简单的逻辑，如：sleep、查库等")]),s._v(" "),t("li",[s._v("驱动函数使用的是grpc，可以用python、Java、go等语言实现，结果依赖于grpc的返回，目前代码中没有实现读取返回内容")]),s._v(" "),t("li",[s._v("使用"),t("code",[s._v("hrp_step_request")]),s._v("作为请求内容的参数，使用"),t("code",[s._v("hrp_step_response")]),s._v("作为返回内容的参数")])]),s._v(" "),t("p",[s._v("在没看源码时，一直觉得应该是使用相同的参数，但是一直提示"),t("code",[s._v("request")]),s._v("、"),t("code",[s._v("response")]),s._v("变量不存在，")]),s._v(" "),t("h2",{attrs:{id:"原有功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原有功能"}},[s._v("#")]),s._v(" 原有功能")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("SetupHooks")]),s._v(" 和 "),t("code",[s._v("TeardownHooks")]),s._v(" 支持多个函数操作")]),s._v(" "),t("li",[s._v("每个函数没有对返回值进行处理")])]),s._v(" "),t("h2",{attrs:{id:"实现功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现功能"}},[s._v("#")]),s._v(" 实现功能")]),s._v(" "),t("blockquote",[t("p",[s._v("前提条件：尽量保存原有的逻辑")])]),s._v(" "),t("ol",[t("li",[s._v("由于接口需要加解密的操作，需要可以对请求内容进行加密、对返回内容进行解密")]),s._v(" "),t("li",[s._v("使用"),t("code",[s._v("request")]),s._v("作为请求参数、"),t("code",[s._v("response")]),s._v("返回参数，如果用上前缀比较繁琐")]),s._v(" "),t("li",[s._v("由于hooks是一个列表，如果有多个修改将以最后的修改为准")])]),s._v(" "),t("h2",{attrs:{id:"修改源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改源码"}},[s._v("#")]),s._v(" 修改源码")]),s._v(" "),t("blockquote",[t("p",[s._v("如果你对源码还不够熟悉，可以先从"),t("a",{attrs:{href:"https://yangfan.gd.cn/hrp/",target:"_blank",rel:"noopener noreferrer"}},[s._v("源码解析"),t("OutboundLink")],1),s._v("开始\n本次代码修改已在4.3.3中被采纳，如果低于当前版本可以自己修改\n主要修改文件***hrp/step_request.go***")])]),s._v(" "),t("p",[s._v("以下代码中，由于"),t("code",[s._v("SetupHooks")]),s._v(" 和 "),t("code",[s._v("TeardownHooks")]),s._v("的实现方式不同，呈现出来修改的也不同，在尽量保持和源码写法一致时作出的修改，每次调用时都会更新最新内容")]),s._v(" "),t("div",{staticClass:"language-golang line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('// runStepRequest 执行请求\nfunc runStepRequest(r *SessionRunner, step *TStep) (stepResult *StepResult, err error) {\n\t// 省略非关键代码\n\t// add request object to step variables, could be used in setup hooks\n\t// 将请求对象添加到step变量中，hook中可以直接使用hrp_step_name、hrp_step_request、request 变量\n\tstepVariables["hrp_step_name"] = step.Name\n\tstepVariables["hrp_step_request"] = rb.requestMap\n\t// 增加request变量\n\tstepVariables["request"] = rb.requestMap  \n\n\t// deal with setup hooks\n\t// 遍历setp hook并执行\n\tfor _, setupHook := range step.SetupHooks {\n\t\t// 调用hook\n\t\treq, err := parser.Parse(setupHook, stepVariables)\n\t\tif err != nil {\n\t\t\treturn stepResult, errors.Wrap(err, "run setup hooks failed")\n\t\t}\n\t\t// 处理hook返回的结果\n\t\treqMap, ok := req.(map[string]interface{})\n\t\t// 每次调用回写request信息\n\t\tif ok && reqMap != nil {\n\t\t\trb.requestMap = reqMap\n\t\t\tstepVariables["request"] = reqMap\n\t\t}\n\t}\n\t// 将hook处理后的结果回写到请求对象中，主要更新body和header的内容\n\t// 由于每次调用信息已经回写，这里只需要判断是否有setup hooks\n\tif len(step.SetupHooks) > 0 {\n\t\t// 更新body的内容\n\t\trequestBody, ok := rb.requestMap["body"].(map[string]interface{})\n\t\tif ok {\n\t\t\tbody, err := json.Marshal(requestBody)\n\t\t\tif err == nil {\n\t\t\t\trb.req.Body = io.NopCloser(bytes.NewReader(body))\n\t\t\t\trb.req.ContentLength = int64(len(body))\n\t\t\t}\n\t\t}\n\t\t// 更新header的内容\n\t\theaders, ok := rb.requestMap["headers"].(map[string]string)\n\t\trb.req.Header = map[string][]string{}\n\t\tfor key, value := range headers {\n\t\t\trb.req.Header.Set(key, value)\n\t\t}\n\t}\n    \n    // 省略非关键代码\n    \n    // add response object to step variables, could be used in teardown hooks\n\t// 将响应对象添加到step变量中，hrp_step_response、response 变量\n\tstepVariables["hrp_step_response"] = respObj.respObjMeta\n\t// 添加response变量\n\tstepVariables["response"] = respObj.respObjMeta\n\n\t// add response object to step variables, could be used in teardown hooks\n\t// 将响应对象添加到step变量中，hrp_step_response、response 变量\n\tstepVariables["hrp_step_response"] = respObj.respObjMeta\n\tstepVariables["response"] = respObj.respObjMeta\n\n\t// deal with teardown hooks\n\t// 遍历teardown hook并执行\n\t// 于setup hooks不同的实现方式，直接更新respObj.respObjMeta\n\tfor _, teardownHook := range step.TeardownHooks {\n\t\t// 调用hook\n\t\tres, err := parser.Parse(teardownHook, stepVariables)\n\t\tif err != nil {\n\t\t\treturn stepResult, errors.Wrap(err, "run teardown hooks failed")\n\t\t}\n\t\t// 处理hook返回的结果\n\t\tresMpa, ok := res.(map[string]interface{})\n\t\tif ok {\n\t\t\tstepVariables["response"] = resMpa\n\t\t\trespObj.respObjMeta = resMpa\n\t\t}\n\t}\n\t// 将hook处理后的结果回写到响应对象中\n\tsessionData.ReqResps.Request = rb.requestMap\n\t// 使用更新后的respObj.respObjMeta\n\tsessionData.ReqResps.Response = builtin.FormatResponse(respObj.respObjMeta)\n\n\t// 省略非关键代码\n}\n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br")])]),t("h2",{attrs:{id:"单元测试-demo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单元测试-demo"}},[s._v("#")]),s._v(" 单元测试&&demo")]),s._v(" "),t("p",[s._v("为了使我们改动的代码更加稳定，让其他使用者可以更清楚如何使用，通过yaml实现，通过单元测试调用，下面是简单例子")]),s._v(" "),t("p",[t("img",{attrs:{src:a(457),alt:"hooks"}})]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("base_url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://httpbin.org/'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("teststeps")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" post 请求\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bar1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("method")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" POST\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /post\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Content-Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application/x-www-form-urlencoded"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" foo1\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" foo3\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("validate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("setup_hooks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${setup_hook($request)}'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("teardown_hooks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${teardown_hook($response)}'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setup_hook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headers"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hook"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"header setup hook"')]),s._v("\n    request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hook"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"body setup hook"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" request\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("teardown_hook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"body"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hook"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"测试 teardown hook"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" hrp\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testing"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" yangfanHooks "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tmpl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"testcases/yangfan_hooks.yml"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TestRunHook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("testing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("buildHashicorpPyPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("defer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("removeHashicorpPyPlugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\ttestCase "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("TestCasePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yangfanHooks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\terr "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewRunner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GenHTMLReport")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("testCase"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// hrp.Run(testCase)")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Fatal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);